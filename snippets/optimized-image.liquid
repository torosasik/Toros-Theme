{% comment %}
  Optimized image loading with WebP support and lazy loading
  Usage: {% render 'optimized-image', image: image, width: width, height: height, alt: alt, class: class, loading: loading %}
{% endcomment %}

{%- liquid
  assign image_width = width | default: image.width
  assign image_height = height | default: image.height
  assign image_alt = alt | default: image.alt | escape
  assign image_class = class | default: ''
  assign loading_type = loading | default: 'lazy'
-%}

<picture>
  <source
    srcset="{{ image | image_url: width: image_width, height: image_height, format: 'webp' }}"
    type="image/webp"
  >
  <img
    src="{{ image | image_url: width: image_width, height: image_height }}"
    alt="{{ image_alt }}"
    width="{{ image_width }}"
    height="{{ image_height }}"
    loading="{{ loading_type }}"
    class="{{ image_class }}"
    {% if loading_type == 'lazy' %}
      decoding="async"
    {% endif %}
  >
</picture> 